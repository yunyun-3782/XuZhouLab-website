// Name: JSON
// ID: skyhigh173JSON
// Description: Handle JSON strings and arrays.
// By: Skyhigh173 <https://scratch.mit.edu/users/Skyhigh173/>
// By: Mio <https://scratch.mit.edu/users/0znzw/>
// License: MIT

/* generated l10n code */Scratch.translate.setup({"ca":{"_Advanced":"Avanat"},"cs":{"_Advanced":"Pokroilé"},"de":{"_Advanced":"Erweitert"},"es":{"_Advanced":"Avanzado"},"fi":{"_Advanced":"Edistykselliset","_Array":"Taulukko","_General Utils":"Yleiset tykalut","_Lists":"Listat","_Object":"Olio","_[analysis] of array [list]":"taulukon [list] [analysis]","_[json] contains key [key]?":"sisltk [json] avaimen [key]?","_[json] contains value [value]?":"sisltk [json] arvon [value]?","_add [item] to array [json]":"lis [item] taulukkoon [json]","_all [Stype] of [json]":"kaikki JSO-koodin [json] [Stype] ","_array concat [json] [json2]":"yhdist taulukot [json] ja [json2]","_array from text [json]":"taulukko tekstist [json]","_ascending":"nousevaan","_average":"keskiarvo","_create array by [text] with delimiter [d]":"luo taulukko tekstist [text] erottimella [d] ","_datas":"datat","_delete [item] in [json]":"poista [item] JSON-koodissa [json]","_delete all [item] in array [json]":"poista jokainen [item] taulukosta [json]","_delete item [item] of array [json]":"poista taulukon [json] [item]. kohde","_descending":"laskevaan","_flat array [json] by depth [depth]":"alenna taulukkoa [json] [depth] tasolla","_get all values with key [key] in array [json]":"kaikki taulukon [json] arvot avaimella [key]","_get list [list] as array":"lista [list] taulukkona","_insert [item] at [pos] of array [json]":"lis [item] taulukon [json] [pos]. kohtaan","_is JSON [json] valid?":"onko JSON-koodi [json] kelvollinen?","_is [json] [types]?":"onko [json] [types]?","_item # of [item] in array [json]":"taulukon [json] kohteen [item] numero","_item [item] of array [json]":"taulukon [json] [item]. kohde","_items [item] to [item2] of array [json]":"taulukon [json] kohteet [item] C [item2]","_join string by array [json] with delimiter [d]":"tee taulukosta [json] merkkijono erottimella [d]","_keys":"avaimet","_length of array [json]":"taulukon [json] pituus","_length of json [json]":"JSON-koodin [json] pituus","_maximum value":"suurin arvo","_median":"mediaani","_minimum value":"pienin arvo","_mode":"moodi","_new [json]":"uusi [json]","_replace item [pos] of [json] with [item]":"korvaa taulukon [json] [pos]. kohde arvolla [item]","_reverse array [json]":"taulukko [json] knteisen","_select a list":"valitse lista","_set [item] in [json] to [value]":"aseta [item] JSON-koodissa [json] arvoon [value]","_set length of array [json] to [len]":"aseta taulukon [json] pituus arvoon [len]","_set list [list] to [json]":"aseta lista [list] arvoon [json]","_sort array [list] in [order] order":"jrjest taulukko [list] [order] jrjestykseen","_sum":"summa","_value of [item] in [json]":"avaimen [item] arvo JSON-koodissa [json]","_values":"arvot","_variance":"varianssi"},"fr":{"_Advanced":"Avancé"},"hu":{"_Advanced":"Haladó"},"it":{"_Advanced":"Impostazioni Avanzate"},"ja":{"_Advanced":"O定","_General Utils":"用ユ`ティリティ","_Lists":"リスト","_Object":"オブジェクト","_[analysis] of array [list]":"array[list]の[analysis]","_[json1] [equal] [json2]":"[json1][equal][json2]","_[json] contains key [key]?":"[json]がキ`[key]を含む","_[json] contains value [value]?":"[json]が[value]を含む","_add [item] to array [json]":"[item]をArray[json]に追加する","_all [Stype] of [json]":"[json]のすべての[Stype]","_array concat [json] [json2]":"Array[json]と[json2]をつなぐ","_array from text [json]":"テキスト[json]からのArray","_ascending":"数がえていく","_average":"平均","_create array by [text] with delimiter [d]":"Arrayを[text]から区切り文字[d]で作る","_datas":"デ`タ","_delete [item] in [json]":"[json]の[item]を削除する","_delete all [item] in array [json]":"Array[json]の[item]をすべて削除する","_delete item [item] of array [json]":"Array[json]の[item]番目を削除する","_descending":"数がp少","_flat array [json] by depth [depth]":"Array[json]を深さ[depth]で平らにする","_get all values with key [key] in array [json]":"キ`[key]のすべてのをArray[json]から取得する","_get list [list] as array":"リスト[list]のArray","_insert [item] at [pos] of array [json]":"Array[json]の[pos]番目に[item]を啡毪工","_is JSON [json] valid?":"JSON[json]が有","_is [json] [types]?":"[json]が[types]","_item # of [item] in array [json]":"Array[json]の[item]の鏊","_item [item] of array [json]":"Array[json]の[item]番目","_items [item] to [item2] of array [json]":"Array[json]の[item]から[item2]番目","_join string by array [json] with delimiter [d]":"Array[json]を区切り文字[d]でつなげる","_keys":"キ`","_length of array [json]":"Array[json]のLさ","_length of json [json]":"JSON[json]のLさ","_maximum value":"一番数が大きい","_median":"中央","_minimum value":"一番数が小さい","_mode":"最l","_new [json]":"新しい[json]","_replace item [pos] of [json] with [item]":"[json]の[pos]番目を[item]で置きQえる","_reverse array [json]":"Array[json]の番を逆にする","_select a list":"リストをxk","_set [item] in [json] to [value]":"[json]の[item]を[value]にする","_set length of array [json] to [len]":"Array[json]のLさを[len]にする","_set list [list] to [json]":"リスト[list]を[json]にする","_sort array [list] in [order] order":"Array[list]を[order]ようにKべる","_sum":"和","_value of [item] in [json]":"[json]の[item]の","_values":"","_variance":"分散"},"ja-hira":{"_Advanced":"こうどなせってい"},"ko":{"_Advanced":" ","_Array":"","_General Utils":" ","_Lists":"","_Object":"","_[json] contains key [key]?":"[json]() [key]  ?","_[json] contains value [value]?":"[json]() [value]  ?","_add [item] to array [json]":" [json] [item] ","_all [Stype] of [json]":"[json]  [Stype]","_array concat [json] [json2]":"  [json] [json2]","_array from text [json]":"  [json]","_ascending":"","_create array by [text] with delimiter [d]":"[text]  [d]()  ","_datas":"","_delete [item] in [json]":"[json] [item]() ","_delete all [item] in array [json]":" [json] [item]()  ","_delete item [item] of array [json]":" [json] [item] ","_descending":"","_flat array [json] by depth [depth]":"  [depth]  [json]","_get all values with key [key] in array [json]":" [json]  [key] ","_get list [list] as array":" [list]() ","_insert [item] at [pos] of array [json]":" [json] [pos] [item] ","_is JSON [json] valid?":"JSON [json]() ?","_is [json] [types]?":"[json]() [types]?","_item # of [item] in array [json]":" [json] [item]  ","_item [item] of array [json]":" [json] [item] ","_items [item] to [item2] of array [json]":" [json] [item] [item2] ","_join string by array [json] with delimiter [d]":" [json]()  [d]() ","_keys":"","_length of array [json]":" [json] ","_length of json [json]":"JSON [json] ","_new [json]":" [json]","_replace item [pos] of [json] with [item]":" [json] [pos]  [item]() ","_reverse array [json]":"  [json]","_select a list":"( )","_set [item] in [json] to [value]":"[json] [item]  [value]() ","_set length of array [json] to [len]":" [json]  [len]() ","_set list [list] to [json]":" [list]() [json]() ","_sort array [list] in [order] order":" [list]() [order] ","_value of [item] in [json]":"[json] [item] ","_values":""},"lt":{"_Advanced":"Iplstiniai"},"nb":{"_Advanced":"Avansert","_keys":"nkler","_values":"verdier"},"nl":{"_Advanced":"Geavanceerd","_General Utils":"Algemeen","_Lists":"Lijsten","_[json] contains key [key]?":"[json] bevat sleutel [key]?","_[json] contains value [value]?":"[json] bevat waarde [value]?","_add [item] to array [json]":"voeg [item] toe aan array [json]","_all [Stype] of [json]":"alle [Stype] van [json]","_array concat [json] [json2]":"voeg arrays [json] en [json2] samen","_array from text [json]":"array van tekst [json]","_ascending":"oplopende","_create array by [text] with delimiter [d]":"creer array uit [text] met scheidingsteken [d]","_datas":"gegevens","_delete [item] in [json]":"verwijder [item] van [json]","_delete all [item] in array [json]":"verwijder alle [item] van array [json]","_delete item [item] of array [json]":"verwijder item [item] van array [json]","_descending":"aflopende","_flat array [json] by depth [depth]":"vlak array [json] af op diepte [depth]","_get all values with key [key] in array [json]":"alle waarden met sleutel [key] in array [json]","_get list [list] as array":"lijst [list] als array","_insert [item] at [pos] of array [json]":"voeg [item] in op [pos] van array [json]","_is JSON [json] valid?":"is JSON [json] geldig?","_is [json] [types]?":"is [json] [types] ?","_item # of [item] in array [json]":"item # van [item] in array [json]","_item [item] of array [json]":"item [item] van array [json]","_items [item] to [item2] of array [json]":"items [item] t/m [item2] van array [json]","_join string by array [json] with delimiter [d]":"voeg array [json] samen tot string met scheidingsteken [d]","_keys":"sleutels","_length of array [json]":"lengte van array [json]","_length of json [json]":"lengte van JSON [json]","_new [json]":"nieuw(e) [json]","_replace item [pos] of [json] with [item]":"vervang item [pos] van [json] door [item]","_reverse array [json]":"keer array [json] om","_select a list":"selecteer een lijst","_set [item] in [json] to [value]":"maak [item] in [json] [value]","_set length of array [json] to [len]":"maak lengte van array [json] [len]","_set list [list] to [json]":"maak lijst [list] [json]","_sort array [list] in [order] order":"sorteer array [list] in [order] volgorde","_value of [item] in [json]":"waarde van [item] in [json]","_values":"waarden"},"pl":{"_Advanced":"Zaawansowane"},"pt":{"_Advanced":"Avanado"},"pt-br":{"_Advanced":"Avanado"},"ro":{"_Advanced":"Avansat"},"ru":{"_Advanced":"Дополнительно","_Array":"Массив","_General Utils":"Главные Утилиты","_Lists":"Списки","_Object":"Объект","_[analysis] of array [list]":"[analysis] массива [list]","_[json] contains key [key]?":"[json] содержит ключ [key]?","_[json] contains value [value]?":"[json] содержит значение [value]?","_add [item] to array [json]":"добавить [item] к массиву [json]","_all [Stype] of [json]":"все [Stype] [json]","_array concat [json] [json2]":"соединить массив [json] и [json2]","_array from text [json]":"массив из текста [json]","_ascending":"нарастающей","_average":"среднее","_create array by [text] with delimiter [d]":"создать массив из [text] с разделителем [d]","_datas":"данные","_delete [item] in [json]":"удалить [item] из [json]","_delete all [item] in array [json]":"удалить все [item] в массиве [json]","_delete item [item] of array [json]":"удалить [item] в массиве [json]","_descending":"опускающей","_flat array [json] by depth [depth]":"плоский массив [json] по глубине [depth]","_get all values with key [key] in array [json]":"получить все значения с ключом [key] в массиве [json]","_get list [list] as array":"получить список [list] как массив","_insert [item] at [pos] of array [json]":"вставить [item] на позицию [pos] массива [json]","_is JSON [json] valid?":"JSON [json] правилен?","_is [json] [types]?":"[json] [types]?","_item # of [item] in array [json]":"значение # [item] массива [json]","_item [item] of array [json]":"[item] массива [json]","_items [item] to [item2] of array [json]":"значения с [item] до [item2] массива [json]","_join string by array [json] with delimiter [d]":"присоединить строку массива [json] с разделителем [d]","_keys":"ключи","_length of array [json]":"длина массива [json]","_length of json [json]":"длина json [json]","_maximum value":"максимальное значение","_median":"медиан","_minimum value":"минимальное значение","_mode":"режим","_new [json]":"новый [json]","_replace item [pos] of [json] with [item]":"заменить число [pos] матрицы [json] на [item]","_reverse array [json]":"обернуть массив [json]","_select a list":"выберите список","_set [item] in [json] to [value]":"задать [item] в [json] на [value]","_set length of array [json] to [len]":"задать длину массива [json] на [len]","_set list [list] to [json]":"задать список [list] в [json]","_sort array [list] in [order] order":"сортировать массив [list] в порядке [order]","_sum":"сумма","_value of [item] in [json]":"значение [item] в [json]","_values":"значения","_variance":"расхождение"},"sl":{"_Advanced":"Napredno"},"sr":{"_Advanced":"Напредно"},"sv":{"_Advanced":"Avancerat"},"tr":{"_Advanced":"Gelimi"},"uk":{"_ascending":"зростання","_descending":"спадання"},"vi":{"_Advanced":"Nng cao"},"zh-cn":{"_Advanced":"高级","_Array":"数组","_General Utils":"通用","_Lists":"原版列表","_[analysis] of array [list]":"数组[list]的[analysis]","_[json1] [equal] [json2]":"[json1][equal][json2]","_[json] contains key [key]?":"[json]包括键[key]？","_[json] contains value [value]?":"[json]包括值[value]？","_add [item] to array [json]":"将[item]加入数组[json]","_all [Stype] of [json]":"[json]的所有[Stype]","_array concat [json] [json2]":"合并数组[json]和[json2]","_array from text [json]":"来自文本[json]的数组","_ascending":"正序","_average":"平均值","_create array by [text] with delimiter [d]":"以[d]分割字符串[text]为数组","_datas":"数据","_delete [item] in [json]":"删除[json]中的[item]","_delete all [item] in array [json]":"删除数组[json]中的所有[item]","_delete item [item] of array [json]":"删除数组[json]的第[item]项","_descending":"倒序","_flat array [json] by depth [depth]":"扁平化数组[json][depth]层","_get all values with key [key] in array [json]":"获取数组[json]中所有[key]的值","_get list [list] as array":"获取原版列表[list]","_insert [item] at [pos] of array [json]":"在数组[json]的第[pos]项前插入[item]","_is JSON [json] valid?":"[json]是合法JSON？","_is [json] [types]?":"[json]是[types]？","_item # of [item] in array [json]":"数组[json]中[item]的位置","_item [item] of array [json]":"数组[json]的第[item]项","_items [item] to [item2] of array [json]":"数组[json]的[item]到[item2]项","_join string by array [json] with delimiter [d]":"将数组[json]用分隔符[d]连成字符串","_keys":"键","_length of array [json]":"数组[json]的长度","_length of json [json]":"JSON[json]的长度","_maximum value":"最大值","_median":"中位数","_minimum value":"最小值","_mode":"众数","_new [json]":"新[json]","_replace item [pos] of [json] with [item]":"替换数组[json]的第[pos]项为[item]","_reverse array [json]":"反转数组[json]","_select a list":"请选择一个列表","_set [item] in [json] to [value]":"将[json]中的[item]设为[value]","_set length of array [json] to [len]":"将数组[json]的长度设为[len]","_set list [list] to [json]":"将列表[list]设为[json]","_sort array [list] in [order] order":"以[order]排列数组[list]","_sum":"和","_value of [item] in [json]":"[json]中的[item]","_values":"值","_variance":"方差"},"zh-tw":{"_Advanced":"e更改"}});/* end generated l10n code */(function (Scratch) {
  "use strict";
  /*
   * JSON extension v2.6 by skyhigh173 (English Version)
   * Do not remove this comment
   */

  const vm = Scratch.vm;
  const hasOwn = (obj, property) =>
    Object.prototype.hasOwnProperty.call(obj, property);

  const makeLabel = (text) => ({
    blockType: "label",
    text: text,
  });

  class JSONS {
    getInfo() {
      return {
        id: "skyhigh173JSON",
        // eslint-disable-next-line extension/should-translate
        name: "JSON",
        color1: "#3271D0",
        blocks: [
          makeLabel(Scratch.translate("General Utils")),
          {
            opcode: "json_is_valid",
            blockType: Scratch.BlockType.BOOLEAN,
            text: Scratch.translate("is JSON [json] valid?"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"key":"value"}',
              },
            },
          },
          {
            opcode: "json_is",
            blockType: Scratch.BlockType.BOOLEAN,
            text: Scratch.translate("is [json] [types]?"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"key":"value"}',
              },
              types: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "Object",
                menu: "types",
              },
            },
          },
          "---",
          {
            opcode: "json_get_all",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("all [Stype] of [json]"),
            arguments: {
              Stype: {
                type: Scratch.ArgumentType.STRING,
                menu: "get_all",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"key":"value","key2":"value2"}',
              },
            },
          },
          {
            opcode: "json_new",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("new [json]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "Object",
                menu: "types",
              },
            },
          },
          "---",
          {
            opcode: "json_has_key",
            blockType: Scratch.BlockType.BOOLEAN,
            text: Scratch.translate("[json] contains key [key]?"),
            arguments: {
              key: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "key2",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"key":"value"}',
              },
            },
          },
          {
            opcode: "json_has_value",
            blockType: Scratch.BlockType.BOOLEAN,
            text: Scratch.translate("[json] contains value [value]?"),
            arguments: {
              value: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "scratch",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["TurboWarp","scratch"]',
              },
            },
          },
          {
            opcode: "json_equal",
            blockType: Scratch.BlockType.BOOLEAN,
            text: Scratch.translate("[json1] [equal] [json2]"),
            arguments: {
              json1: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"a":0,"b":1}',
              },
              json2: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"b":1,"a":0}',
              },
              equal: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "=",
                menu: "equal",
              },
            },
          },
          makeLabel("JSON Strings"),
          {
            opcode: "json_jlength",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("length of json [json]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"key":"value","key2":"value2"}',
              },
            },
          },
          {
            opcode: "json_get",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("value of [item] in [json]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "key",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"key":"value"}',
              },
            },
          },
          {
            opcode: "json_set",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("set [item] in [json] to [value]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "key",
              },
              value: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "new value",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"key":"value"}',
              },
            },
          },
          {
            opcode: "json_delete",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("delete [item] in [json]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "key2",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '{"key":"value","key2":"value2"}',
              },
            },
          },
          makeLabel(Scratch.translate("Array")),
          {
            opcode: "json_length",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("length of array [json]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "[1,2,3]",
              },
            },
          },
          {
            opcode: "json_array_get",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("item [item] of array [json]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 1,
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["scratch","TurboWarp"]',
              },
            },
          },
          {
            opcode: "json_array_push",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("add [item] to array [json]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "TurboWarp",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["scratch"]',
              },
            },
          },
          {
            opcode: "json_array_set",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("replace item [pos] of [json] with [item]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "fav",
              },
              pos: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 2,
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["love","heart","follow"]',
              },
            },
          },
          {
            opcode: "json_array_insert",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("insert [item] at [pos] of array [json]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "fav",
              },
              pos: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 2,
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["love","follow"]',
              },
            },
          },
          "---",
          {
            opcode: "json_array_delete",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("delete item [item] of array [json]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 2,
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["scratch","a","TurboWarp"]',
              },
            },
          },
          {
            opcode: "json_array_remove_all",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("delete all [item] in array [json]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "a",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["scratch","a","TurboWarp","a","a"]',
              },
            },
          },
          "---",
          {
            opcode: "json_array_itemH",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("item # of [item] in array [json]"),
            arguments: {
              item: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "scratch",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["scratch","TurboWarp"]',
              },
            },
          },
          makeLabel(Scratch.translate("Advanced")),
          {
            opcode: "json_array_from",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("array from text [json]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "abcd",
              },
            },
          },
          {
            opcode: "json_array_fromto",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("items [item] to [item2] of array [json]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "[1,2,3,4]",
              },
              item: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 2,
              },
              item2: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 3,
              },
            },
          },
          {
            opcode: "json_array_reverse",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("reverse array [json]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["a","b","c","d","e","f"]',
              },
            },
          },
          {
            opcode: "json_array_flat",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("flat array [json] by depth [depth]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "[[1],2,[3,4],[5,[6]]]",
              },
              depth: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 2,
              },
            },
          },
          {
            opcode: "json_array_concat",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("array concat [json] [json2]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["a","b"]',
              },
              json2: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["c","d"]',
              },
            },
          },
          {
            opcode: "json_array_filter",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate(
              "get all values with key [key] in array [json]"
            ),
            arguments: {
              key: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "id",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '[{"id":12},{"id":24}]',
              },
            },
          },
          {
            opcode: "json_array_setlen",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("set length of array [json] to [len]"),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["a","b","c"]',
              },
              len: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 2,
              },
            },
          },
          "---",
          {
            opcode: "json_array_create",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate(
              "create array by [text] with delimiter [d]"
            ),
            arguments: {
              text: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "a,b,c",
              },
              d: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: ",",
              },
            },
          },
          {
            opcode: "json_array_join",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate(
              "join string by array [json] with delimiter [d]"
            ),
            arguments: {
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["a","b","c"]',
              },
              d: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: ",",
              },
            },
          },
          "---",
          {
            opcode: "json_array_sort",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("sort array [list] in [order] order"),
            disableMonitor: true,
            arguments: {
              list: {
                type: Scratch.ArgumentType.STRING,
                defaultValue:
                  "[5.23, 214, 522, 61, 5.24, 62.2, 1, 51212, 0, 0]",
              },
              order: {
                type: Scratch.ArgumentType.STRING,
                menu: "sort_order",
              },
            },
          },
          {
            opcode: "json_array_analysis",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("[analysis] of array [list]"),
            disableMonitor: true,
            arguments: {
              list: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "[17, 1, 2017, 0, 120, 14]",
              },
              analysis: {
                type: Scratch.ArgumentType.STRING,
                menu: "analysis",
              },
            },
          },
          makeLabel(Scratch.translate("Lists")),
          {
            opcode: "json_vm_getlist",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("get list [list] as array"),
            arguments: {
              list: {
                type: Scratch.ArgumentType.STRING,
                menu: "get_list",
              },
            },
          },
          {
            opcode: "json_vm_setlist",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("set list [list] to [json]"),
            arguments: {
              list: {
                type: Scratch.ArgumentType.STRING,
                menu: "get_list",
              },
              json: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: '["apple","banana"]',
              },
            },
          },
        ],
        menus: {
          get_all: {
            items: [
              {
                text: Scratch.translate("keys"),
                value: "keys",
              },
              {
                text: Scratch.translate("values"),
                value: "values",
              },
              {
                text: Scratch.translate("datas"),
                value: "datas",
              },
            ],
          },
          get_list: {
            acceptReporters: true,
            items: "getLists",
          },
          types: {
            acceptReporters: true,
            items: [
              {
                text: Scratch.translate("Object"),
                value: "Object",
              },
              {
                text: Scratch.translate("Array"),
                value: "Array",
              },
            ],
          },
          equal: {
            acceptReporters: true,
            items: ["=", "≠"],
          },
          sort_order: {
            acceptReporters: true,
            items: [
              {
                text: Scratch.translate("ascending"),
                value: "ascending",
              },
              {
                text: Scratch.translate("descending"),
                value: "descending",
              },
            ],
          },
          analysis: {
            acceptReporters: true,
            items: [
              {
                text: Scratch.translate("minimum value"),
                value: "minimum",
              },
              {
                text: Scratch.translate("maximum value"),
                value: "maximum",
              },
              {
                text: Scratch.translate("sum"),
                value: "sum",
              },
              {
                text: Scratch.translate("average"),
                value: "average",
              },
              {
                text: Scratch.translate("median"),
                value: "median",
              },
              {
                text: Scratch.translate("mode"),
                value: "mode",
              },
              {
                text: Scratch.translate("variance"),
                value: "variance",
              },
            ],
          },
        },
      };
    }

    getLists() {
      const globalLists = Object.values(
        vm.runtime.getTargetForStage().variables
      ).filter((x) => x.type === "list");
      const localLists = vm.editingTarget
        ? Object.values(vm.editingTarget.variables).filter(
            (x) => x.type === "list"
          )
        : [];
      const uniqueLists = [...new Set([...globalLists, ...localLists])];
      if (uniqueLists.length === 0) {
        return [
          {
            text: Scratch.translate("select a list"),
            value: "select a list",
          },
        ];
      }
      return uniqueLists.map((i) => ({
        text: i.name,
        value: i.id,
      }));
    }

    lookupList(list, util) {
      const byId = util.target.lookupVariableById(list);
      if (byId && byId.type === "list") {
        return byId;
      }
      const byName = util.target.lookupVariableByNameAndType(list, "list");
      if (byName) {
        return byName;
      }
      return null;
    }

    json_is_valid({ json }) {
      if (typeof json != "string") {
        return false;
      }
      json = json.trim();
      if (
        (json.slice(0, 1) != "[" || json.slice(-1) != "]") &&
        (json.slice(0, 1) != "{" || json.slice(-1) != "}")
      ) {
        return false;
      } else {
        try {
          JSON.parse(json);
          return true;
        } catch {
          return false;
        }
      }
    }

    // return object if its json else string
    json_valid_return(json) {
      if (typeof json != "string") {
        return json;
      } else if (
        (json.slice(0, 1) != "[" || json.slice(-1) != "]") &&
        (json.slice(0, 1) != "{" || json.slice(-1) != "}")
      ) {
        return json;
      } else {
        try {
          return JSON.parse(json) ?? "";
        } catch {
          return json;
        }
      }
    }

    json_is({ json, types }) {
      if (!this.json_is_valid({ json: json })) return false;
      try {
        json = JSON.parse(json);
        switch (types) {
          case "Object":
            return !Array.isArray(json);
          case "Array":
            return Array.isArray(json);
          default:
            return false;
        }
      } catch {
        return false;
      }
    }

    json_length({ json }) {
      try {
        json = JSON.parse(json);
        return Object.keys(json).length;
      } catch {
        return " ";
      }
    }

    json_new({ json }) {
      switch (json) {
        case "Object":
          return "{}";
        case "Array":
          return "[]";
        default:
          return "";
      }
    }

    json_has_key({ json, key }) {
      try {
        return (
          this._fixInvalidJSONValues(this.json_valid_return(key)) in
          JSON.parse(json)
        );
      } catch {
        return false;
      }
    }

    json_has_value({ json, value }) {
      try {
        json = JSON.parse(json);
        value = this.json_valid_return(value);
        return json.includes(value);
      } catch {
        return false;
      }
    }

    json_equal({ json1, equal, json2 }) {
      try {
        json1 = JSON.parse(json1);
        json2 = JSON.parse(json2);

        const keys1 = Object.keys(json1);
        const keys2 = Object.keys(json2);
        const result =
          keys1.length === keys2.length &&
          Object.keys(json1).every((key) => json1[key] === json2[key]);
        if (equal === "=") return result;
        if (equal === "≠") return !result;
      } catch {
        // ignore
      }
      return false;
    }

    json_get_all({ Stype, json }) {
      try {
        json = JSON.parse(json);
        switch (Stype) {
          case "keys":
            return JSON.stringify(Object.keys(json).map((key) => key ?? ""));
          case "values":
            return JSON.stringify(
              Object.keys(json).map((key) => json[key] ?? "")
            );
          case "datas":
            return JSON.stringify(
              Object.keys(json).map((key) => [key, json[key] ?? ""])
            );
          default:
            return "";
        }
      } catch {
        return "";
      }
    }

    json_get({ item, json }) {
      try {
        json = JSON.parse(json);
        if (hasOwn(json, item)) {
          const result = json[item] ?? "";
          if (typeof result === "object") {
            return JSON.stringify(result);
          } else {
            return result;
          }
        }
      } catch {
        // ignore
      }
      return "";
    }

    _fixInvalidJSONValues(value) {
      // JSON does not support these values, so convert to string.
      if (Number.isNaN(value)) return "NaN";
      if (value === Infinity) return "Infinity";
      if (value === -Infinity) return "-Infinity";
      // null and undefined -> empty
      return value ?? "";
    }

    json_set({ item, value, json }) {
      try {
        json = JSON.parse(json);
        value = this.json_valid_return(value);
        value = this._fixInvalidJSONValues(value);
        json[item] = value;
        return JSON.stringify(json);
      } catch {
        return "";
      }
    }

    json_delete({ item, json }) {
      try {
        json = JSON.parse(json);
        delete json[item];
        return JSON.stringify(json);
      } catch {
        return "";
      }
    }

    json_jlength({ json }) {
      // same function
      return this.json_length({ json: json });
    }

    json_array_get({ item, json }) {
      // 1...length : array content, -1...-length : reverse array content, 0 : ERROR
      try {
        item = Scratch.Cast.toNumber(item);
        if (item == 0) return "";
        if (item > 0) {
          item--;
        }
        json = JSON.parse(json);
        let result;
        if (item >= 0) {
          result = json[item];
        } else {
          const length = Scratch.Cast.toNumber(json.length);
          result = json[length + item];
        }
        result = result ?? "";
        if (typeof result == "object") {
          return JSON.stringify(result);
        } else {
          return result;
        }
      } catch {
        return "";
      }
    }

    json_array_itemH({ item, json }) {
      try {
        json = JSON.parse(json);
        item = this._fixInvalidJSONValues(this.json_valid_return(item));
        let result = JSON.stringify(json.indexOf(item) + 1);
        return result;
      } catch {
        return "";
      }
    }

    json_array_from({ json }) {
      try {
        return JSON.stringify(Array.from(String(json)));
      } catch {
        return "";
      }
    }

    json_array_concat({ json, json2 }) {
      try {
        json = JSON.parse(json);
        json2 = JSON.parse(json2);
        return JSON.stringify(json.concat(json2));
      } catch {
        return "";
      }
    }

    json_array_push({ item, json }) {
      try {
        json = JSON.parse(json);
        item = this._fixInvalidJSONValues(this.json_valid_return(item));
        json.push(item);
        return JSON.stringify(json);
      } catch {
        return "";
      }
    }

    json_array_insert({ item, pos, json }) {
      try {
        json = JSON.parse(json);
        item = this._fixInvalidJSONValues(this.json_valid_return(item));
        json.splice(pos - 1, 0, item);
        return JSON.stringify(json);
      } catch {
        return "";
      }
    }

    json_array_set({ item, pos, json }) {
      try {
        json = JSON.parse(json);
        json[pos - 1] = this._fixInvalidJSONValues(
          this.json_valid_return(item)
        );
        return JSON.stringify(json);
      } catch {
        return "";
      }
    }

    json_array_delete({ item, json }) {
      try {
        json = JSON.parse(json);
        json.splice(item - 1, 1);
        return JSON.stringify(json);
      } catch {
        return "";
      }
    }

    json_array_remove_all({ item, json }) {
      try {
        json = JSON.parse(json);
        item = this._fixInvalidJSONValues(this.json_valid_return(item));
        let i = 0;
        while (i < json.length) {
          if (json[i] === item) {
            json.splice(i, 1);
          } else {
            ++i;
          }
        }
        return JSON.stringify(json);
      } catch {
        return "";
      }
    }

    json_array_fromto({ json, item, item2 }) {
      try {
        return JSON.stringify(JSON.parse(json).slice(item - 1, item2));
      } catch {
        return "";
      }
    }

    json_array_reverse({ json }) {
      try {
        return JSON.stringify(JSON.parse(json).reverse());
      } catch {
        return "";
      }
    }

    json_array_flat({ json, depth }) {
      try {
        return JSON.stringify(JSON.parse(json).flat(depth));
      } catch {
        return "";
      }
    }

    json_array_create({ text, d }) {
      return JSON.stringify(String(text).split(d));
    }

    json_array_join({ json, d }) {
      try {
        return JSON.parse(json).join(d);
      } catch {
        return "";
      }
    }

    json_array_filter({ key, json }) {
      try {
        json = JSON.parse(json);
        return JSON.stringify(
          json.map((x) => {
            if (hasOwn(x, key)) {
              return x[key];
            }
            return null;
          })
        );
      } catch (e) {
        return "";
      }
    }

    json_array_setlen({ json, len }) {
      try {
        json = JSON.parse(json);
        json.length = len;
        return JSON.stringify(json);
      } catch {
        return "";
      }
    }

    json_vm_getlist({ list }, util) {
      try {
        let listVariable = this.lookupList(list, util);
        if (listVariable) {
          return JSON.stringify(listVariable.value);
        }
      } catch (e) {
        // ignore
      }
      return "";
    }
    json_vm_setlist({ list, json }, util) {
      try {
        let listVariable = this.lookupList(list, util);
        if (listVariable) {
          const array = JSON.parse(json);
          if (Array.isArray(array)) {
            const safeArray = array.map((i) => {
              if (typeof i === "object") return JSON.stringify(i);
              return i ?? "";
            });
            listVariable.value = safeArray;
          }
        }
      } catch (e) {
        // ignore
      }
      return "";
    }

    json_array_sort(args) {
      let list;
      try {
        list = JSON.parse(args.list);
      } catch {
        return "";
      }
      if (!Array.isArray(list)) {
        return "";
      }
      list.sort(Scratch.Cast.compare);
      if (args.order === "descending") list.reverse();
      return JSON.stringify(list);
    }
    json_array_analysis(args) {
      let list;
      try {
        list = JSON.parse(args.list);
      } catch {
        return 0;
      }
      if (!Array.isArray(list)) {
        return 0;
      }
      list = list.map(Scratch.Cast.toNumber);
      const listLength = list.length;
      switch (Scratch.Cast.toString(args.analysis)) {
        case "maximum": {
          let max = -Infinity;
          for (let i = 0; i < list.length; i++)
            if (list[i] > max) max = list[i];
          return max;
        }
        case "minimum": {
          let min = Infinity;
          for (let i = 0; i < list.length; i++)
            if (list[i] < min) min = list[i];
          return min;
        }
        case "sum":
          return list.reduce((a, b) => a + b, 0);
        case "average":
          return list.reduce((a, b) => a + b, 0) / listLength;
        case "median": {
          const list2 = list.sort(Scratch.Cast.compare);
          const list2Length = list2.length;
          const c = Math.floor(list2Length / 2);
          const e = list2Length % 2 === 0;
          if (e) return (list2[c - 1] + list2[c]) / 2;
          return list2[c];
        }
        case "mode": {
          const freqMap = new Map(),
            mode = [0, 0]; // current mode, max
          for (
            let i = 0, num = list[0], count = null;
            i < listLength;
            i++, num = list[i], count = freqMap.get(num)
          ) {
            count ||= 1;
            if (freqMap.has(num)) ++count;
            if (count > mode[1]) (mode[0] = num), (mode[1] = count);
            freqMap.set(num, count);
          }
          return mode[0];
        }
        case "variance": {
          const average = list.reduce((a, b) => a + b, 0) / listLength;
          const list2 = list.map((a) => (a - average) ** 2);
          return list2.reduce((a, b) => a + b, 0) / listLength;
        }
      }
      return 0;
    }
  }
  Scratch.extensions.register(new JSONS());
})(Scratch);
